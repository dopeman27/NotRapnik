
#Auto zapis podczas pisania
{% extends 'base.html' %}
{% block content %}
  <h1 contenteditable id="note-title">{{ note.title }}</h1>
  <div contenteditable id="note-body" style="white-space: pre-wrap; border:1px solid #ccc; padding:10px;">
    {{ note.body }}
  </div>

  <script>
    function debounce(fn, delay) {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), delay);
      };
    }

    const save = debounce(() => {
      fetch('/api/notes/{{ note.id }}', {
        method: 'PATCH',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          title: document.getElementById('note-title').innerText,
          body: document.getElementById('note-body').innerText
        })
      });
    }, 500);

    document.getElementById('note-title')
            .addEventListener('input', save);
    document.getElementById('note-body')
            .addEventListener('input', save);
  </script>
{% endblock %}
