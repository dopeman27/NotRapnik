
{% extends 'base.html' %}
{% block content %}
  <div class="note-container">
    <div class="note-header">
  <span class="note-label">Tytuł</span>
      <div class="note-dates">
        <span>Utworzone: {{ note.created_at.strftime('%Y-%m-%d %H:%M') }}</span><br>
        <span>Ostatnia modyfikacja: 
          {% if note.updated_at %}
            {{ note.updated_at.strftime('%Y-%m-%d %H:%M') }}
          {% else %}
            {{ note.created_at.strftime('%Y-%m-%d %H:%M') }}
          {% endif %}
        </span>
      </div>
    </div>

    <h1 contenteditable id="note-title" class="note-title">{{ note.title }}</h1>

    <div class="note-body-wrapper">
      <span class="note-label">Treść</span>
      <div contenteditable id="note-body" class="note-body">{{ note.body }}</div>
    </div>
  </div>

  <script>
    function debounce(fn, delay) {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), delay);
      };
    }

    const save = debounce(() => {
      fetch('/api/notes/{{ note.id }}', {
        method: 'PATCH',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          title: document.getElementById('note-title').innerText,
          body: document.getElementById('note-body').innerText
        })
      });
    }, 500);

    document.getElementById('note-title')
            .addEventListener('input', save);
    document.getElementById('note-body')
            .addEventListener('input', save);
  </script>
{% endblock %}
